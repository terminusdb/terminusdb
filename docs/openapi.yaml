openapi: 3.0.1
info:
  title: TerminusDB API
  description: |
    API for the TerminusDB document graph database. Manage databases, documents, schemas, system, and queries.
    
    # Quick Start
    ```bash
    # List databases
    curl -u admin:root http://localhost:6363/api/
    
    # Create database
    curl -u admin:root -X POST http://localhost:6363/api/db/admin/mydb \
         -H "Content-Type: application/json" \
         -d '{"label": "My Database", "comment": "Description"}'
    
    # Insert unstructured JSON document into RDF database
    curl -u admin:root -X POST "http://localhost:6363/api/document/admin/mydb?raw_json=true&author=admin&message=new+document" \
         -H "Content-Type: application/json" \
         -d '{"name": "Alice", "age": 30}'

    # Insert schema for structured JSON documents
    curl -u admin:root -X POST "http://localhost:6363/api/document/admin/mydb?graph_type=schema&author=admin&message=new+schema" \
         -H "Content-Type: application/json" \
         -d '{"@type": "Class", "@id": "Person", "age": "xsd:integer", "name": "xsd:string"}'

    # Insert structured JSON-LD document
    curl -u admin:root -X POST "http://localhost:6363/api/document/admin/mydb?author=admin&message=new+document" \
         -H "Content-Type: application/json" \
         -d '{"@type": "Person", "age": 30, "name": "Alice"}'
    ```

    All structured and unstructured documents are stored as triples in an RDF database, with immutable history with git-for-data, and a powerful datalog query language with unification.
  contact:
    email: support@dfrnt.com
  license:
    name: Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html
  version: 12.0.2
externalDocs:
  description: Find out more about TerminusDB
  url: https://terminusdb.org
servers:
- url: http://localhost:6363/api
security:
- basicAuth: []
tags:
- name: Connection
  description: API connection and server information
- name: Database
  description: Database management operations
- name: Document
  description: Document CRUD operations
- name: Schema
  description: Schema management and validation
- name: WOQL
  description: Web Object Query Language
- name: Collaboration
  description: Remote operations and synchronization
- name: Account management
  description: User roles and capabilities
paths:
  /:
    get:
      operationId: getDatabaseList
      x-python-client: Client::get_databases
      x-js-client: Client.getDatabases
      tags:
        - Connection
      summary: Get a list of databases for the authenticated user
      responses:
        200:
          description: List of databases retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Database'
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
  /info:
    get:
      operationId: getServerInfo
      x-python-client: not_implemented
      x-js-client: Client.info
      tags:
        - Connection
      summary: Get information about the TerminusDB server
      responses:
        200:
          description: Server information retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  "@type":
                    type: string
                    example: api:InfoResponse
                  "api:info":
                    type: object
                    properties:
                      "authority":
                        type: string
                        example: "terminusdb://system/data/User/admin"
                      "storage":
                        type: object
                        properties:
                          "version":
                            type: string
                            example: "1"
                      "terminusdb":
                        type: object
                        properties:
                          "version":
                            type: string
                            example: "12.0.2"
                      "terminusdb_store":
                        type: object
                        properties:
                          "version":
                            type: string
                            example: "0.19.5"
                  "api:status":
                    type: string
                    example: api:success
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
  /ok:
    get:
      operationId: getStatus
      x-python-client: not_implemented
      x-js-client: not_implemented
      tags:
        - Connection
      summary: Simple status update
      description: |
        Simple health check endpoint that always returns 200 OK.
        This endpoint does not require authentication and can be used for basic connectivity checks.
      responses:
        200:
          description: Succeeded
        400:
          description: Bad Request
  /db:
    get:
      operationId: listDatabases
      x-python-client: Client::get_databases
      x-js-client: Client.getDatabases
      tags:
        - Database
      summary: List details of all databases available to the authorized user.
      parameters:
        - name: branches
          in: query
          description: Return branches or not
          required: false
          schema:
            type: boolean
            default: false
        - name: verbose
          in: query
          description: Return all available information
          required: false
          schema:
            type: boolean
            default: false
      responses:
        200:
          description: Database listing
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Database'
        404:
          description: database not found
          content:
            application/json:
              schema:
                type: object

  /db/{organization}/{database}:
    get:
      operationId: getDatabase
      x-python-client: Client::get_database
      x-js-client: not_implemented
      tags:
        - Database
      summary: List details of the database under the given organization.
      parameters:
        - $ref: '#/components/parameters/organization'
        - $ref: '#/components/parameters/database'
        - name: branches
          in: query
          description: Return branches or not
          required: false
          schema:
            type: boolean
            default: false
        - name: verbose
          in: query
          description: Return all available information
          required: false
          schema:
            type: boolean
            default: false
      responses:
        200:
          description: Database listing
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Database'

        404:
          description: Database not found
          content:
            application/json:
              schema:
                type: object
    head:
      operationId: checkDatabaseExists
      x-python-client: Client::has_database
      x-js-client: Client.hasDatabase
      tags:
        - Database
      summary: Check that a db exists
      parameters:
        - $ref: '#/components/parameters/organization'
        - $ref: '#/components/parameters/database'
      responses:
        200:
          description: Database exists
          content:
            application/json:
              schema:
                type: object
        404:
          description: Database not found
          content:
            application/json:
              schema:
                type: object

    post:
      operationId: createDatabase
      x-python-client: Client::create_database
      x-js-client: Client.createDatabase
      tags:
        - Database
      summary: Create a database
      description: |
        Create a new database in the specified organization. Use the request body to set metadata.
        
        **Example:**
        ```bash
        curl -u admin:root -X POST http://localhost:6363/api/db/myorg/mydb \
             -H "Content-Type: application/json" \
             -d '{"label": "My Database", "comment": "Description"}'
        ```
      parameters:
        - $ref: '#/components/parameters/organization'
        - $ref: '#/components/parameters/database'
      requestBody: # TODO: Add prefixes property to schema
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                comment:
                  type: string
                  example: A sample comment for my database
                label:
                  type: string
                  example: Testdatabase
                public:
                  type: boolean
                  example: false
                  description: Should the database be accessible for all users?
                schema:
                  type: boolean
                  example: true
                  description: Should the database be initialized with a schema?
              required:
                - comment
                - label
      responses:
        200:
          description: Added database
          content:
            application/json:
              schema:
                type: object
                properties:
                  "@type":
                    type: string
                    example: api:DbCreateResponse
                  "api:status":
                    type: string
                    example: api:success
        400:
          description: Database already exists
          content:
            application/json:
              schema:
                type: object
                properties:
                  "@type":
                    type: string
                    example: api:DbCreateErrorResponse
                  "api:error":
                    type: object
                    properties:
                      "@type":
                        type: string
                        example: api:DatabaseAlreadyExists
                      "api:database_name":
                        type: string
                        example: MyNewAlreadyExistingDatabase
                      "api:organization_name":
                        type: string
                        example: admin
                  "api:message":
                    type: string
                    example: Database already exists.
                  "api:status":
                    type: string
                    example: api:failure

        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
    delete:
      operationId: deleteDatabase
      x-python-client: Client::delete_database
      x-js-client: Client.deleteDatabase
      tags:
        - Database
      summary: Delete a database
      parameters:
        - $ref: '#/components/parameters/organization'
        - $ref: '#/components/parameters/database'
        - name: force
          in: query
          description: Force database to be delete (useful for databases in inconsistent states)
          required: false
          schema:
            type: boolean
            default: false
      responses:
        200:
          description: Database deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  "@type":
                    type: string
                    example: api:DbDeleteResponse
                  "api:status":
                    type: string
                    example: api:success
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: Can't find DB
          content:
            application/json:
              schema:
                type: object
                properties:
                  "@type":
                    type: string
                    example: api:DbDeleteErrorResponse
                  "api:error":
                    type: object
                    properties:
                      "@type":
                        type: string
                        example: api:UnknownDatabase
                      "api:database_name":
                        type: string
                        example: MyNonExistingDatabase
                      "api:organization_name":
                        type: string
                        example: admin
    put:
      operationId: updateDatabase
      x-python-client: not_implemented
      x-js-client: Client.updateDatabase
      tags:
        - Database
      summary: Change qualities of a database (label, comment, etc.)
      parameters:
        - $ref: '#/components/parameters/organization'
        - $ref: '#/components/parameters/database'
      requestBody: # TODO: Add prefixes property to schema
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                comment:
                  type: string
                  example: A sample comment for my database
                label:
                  type: string
                  example: Testdatabase
                public:
                  type: boolean
                  example: false
                  description: Should the database be accessible for all users?
                schema:
                  type: boolean
                  example: true
                  description: Should the database be initialized with a schema?
              required:
                - comment
                - label
      responses:
        200:
          description: Updated database
          content:
            application/json:
              schema:
                type: object
                properties:
                  "@type":
                    type: string
                    example: api:DbUpdatedResponse
                  "api:status":
                    type: string
                    example: api:success
        404:
          description: Database not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  "@type":
                    type: string
                    example: api:DbUpdateErrorResponse
                  "api:error":
                    type: object
                    properties:
                      "@type":
                        type: string
                        example: api:UnknownDatabase
                      "api:database_name":
                        type: string
                        example: MyNonExistingDatabase
                      "api:organization_name":
                        type: string
                        example: admin
                  "api:message":
                    type: string
                    example: "Unknown database: admin/MyNonExistingDatabase"
                  "api:status":
                    type: string
                    example: api:not_found
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
          
  /prefix/{organization}/{database}/{prefix_name}:
    get:
      operationId: getPrefix
      x-python-client: Client::get_prefix
      x-js-client: Client.getPrefix
      tags:
        - Database
      summary: Get a single prefix mapping
      description: |
        Retrieve the IRI (namespace URL) for a specific prefix name.
        
        **When to use:** Check what a prefix expands to, or verify a prefix exists before using it in documents.
        
        **Example:**
        ```bash
        # Get the 'ex' prefix mapping
        curl -u admin:root http://localhost:6363/api/prefix/admin/mydb/ex
        ```
        
        **Response:**
        ```json
        {
          "@type": "api:PrefixResponse",
          "api:prefix_name": "ex",
          "api:prefix_uri": "http://example.org/",
          "api:status": "api:success"
        }
        ```
      parameters:
        - $ref: '#/components/parameters/organization'
        - $ref: '#/components/parameters/database'
        - name: prefix_name
          in: path
          required: true
          description: |
            The prefix name following XML NCName rules (same as used throughout TerminusDB):
            - Must start with letter (A-Z, a-z) or underscore (_)
            - Can contain letters, digits (0-9), hyphen (-), dot (.), underscore (_)
            - Cannot contain colon (:)
            - Cannot start with @ (reserved) or digit
            
            Examples: 'ex', 'schema', 'v1.0', 'my-api_v2', '_internal'
          schema:
            type: string
            pattern: '^[A-Za-z_][A-Za-z0-9_.-]*$'
            example: ex
      responses:
        200:
          description: Prefix retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  '@type':
                    type: string
                    example: api:PrefixResponse
                  'api:prefix_name':
                    type: string
                    example: ex
                  'api:prefix_uri':
                    type: string
                    example: http://example.org/
                  'api:status':
                    type: string
                    example: api:success
        404:
          description: Prefix not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  '@type':
                    type: string
                    example: api:PrefixErrorResponse
                  'api:status':
                    type: string
                    example: api:not_found
                  'api:error':
                    type: object
                    properties:
                      '@type':
                        type: string
                        example: api:PrefixNotFound
                      'api:prefix_name':
                        type: string
                        example: ex
                  'api:message':
                    type: string
                    example: "Prefix 'ex' not found"
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
          
    post:
      operationId: addPrefix
      x-python-client: Client::add_prefix
      x-js-client: Client.addPrefix
      tags:
        - Database
      summary: Add a new prefix mapping
      description: |
        Create a new prefix-to-IRI mapping. This operation is idempotent for the same name+IRI combination.
        
        **When to use:** Define a new namespace prefix for your documents. For example, add 'schema' â†’ 'http://schema.org/' to use 'schema:Person' in your documents.
        
        **Example:**
        ```bash
        curl -u admin:root -X POST \
          http://localhost:6363/api/prefix/admin/mydb/ex \
          -H "Content-Type: application/json" \
          -d '{"uri": "http://example.org/"}'
        ```
        
        **Response codes:**
        - **201**: Prefix created successfully
        - **204**: Prefix already exists with same IRI (idempotent no-op)
        - **400**: Prefix exists with different IRI, or IRI already used by another prefix
        
        **Tips:**
        - Prefix names must NOT start with '@' (reserved for @base, @schema, etc.)
        - URIs must include a scheme (http://, https://, etc.)
        - Use POST for adding, PUT for updating
      parameters:
        - $ref: '#/components/parameters/organization'
        - $ref: '#/components/parameters/database'
        - name: prefix_name
          in: path
          required: true
          description: The prefix name to create
          schema:
            type: string
            example: ex
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - uri
              properties:
                uri:
                  type: string
                  description: The IRI (namespace URL) this prefix expands to
                  example: http://example.org/
      responses:
        201:
          description: Prefix created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  '@type':
                    type: string
                    example: api:PrefixAddResponse
                  'api:prefix_name':
                    type: string
                    example: ex
                  'api:prefix_uri':
                    type: string
                    example: http://example.org/
                  'api:status':
                    type: string
                    example: api:success
        204:
          description: Prefix already exists with same name and IRI (idempotent no-op)
        400:
          description: Bad request - prefix exists with different IRI, IRI already used by another prefix, invalid IRI, or reserved name
          content:
            application/json:
              schema:
                type: object
                properties:
                  '@type':
                    type: string
                    example: api:PrefixErrorResponse
                  'api:status':
                    type: string
                    example: api:failure
                  'api:error':
                    type: object
                    properties:
                      '@type':
                        type: string
                        enum: [api:PrefixAlreadyExists, api:PrefixUriAlreadyInUse, api:InvalidIRI, api:ReservedPrefix]
                        example: api:PrefixAlreadyExists
                  'api:message':
                    type: string
                    example: "Prefix 'ex' already exists"
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
          
    put:
      operationId: updatePrefix
      x-python-client: Client::update_prefix
      x-js-client: Client.updatePrefix
      tags:
        - Database
      summary: Update or upsert a prefix mapping
      description: |
        Update an existing prefix to point to a different IRI.
        
        **When to use:** Change where a prefix points. For example, switch 'api' from 'http://v1.api/' to 'http://v2.api/'.
        
        **Update vs Upsert:**
        - **Without `?create=true`**: Updates existing prefix (fails if prefix doesn't exist)
        - **With `?create=true`**: Creates OR updates (upsert - always succeeds)
        
        **Examples:**
        ```bash
        # Update existing prefix (fails if not exists)
        curl -u admin:root -X PUT \
          http://localhost:6363/api/prefix/admin/mydb/ex \
          -H "Content-Type: application/json" \
          -d '{"uri": "http://example.com/"}'
        
        # Upsert (create or update)
        curl -u admin:root -X PUT \
          "http://localhost:6363/api/prefix/admin/mydb/ex?create=true" \
          -H "Content-Type: application/json" \
          -d '{"uri": "http://example.net/"}'
        ```
      parameters:
        - $ref: '#/components/parameters/organization'
        - $ref: '#/components/parameters/database'
        - name: prefix_name
          in: path
          required: true
          description: The prefix name to update
          schema:
            type: string
            example: ex
        - name: create
          in: query
          required: false
          description: If true, create the prefix if it doesn't exist (upsert behavior)
          schema:
            type: boolean
            default: false
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - uri
              properties:
                uri:
                  type: string
                  description: The new IRI for this prefix
                  example: http://example.com/
      responses:
        200:
          description: Prefix updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  '@type':
                    type: string
                    example: api:PrefixUpdateResponse
                  'api:prefix_name':
                    type: string
                    example: ex
                  'api:prefix_uri':
                    type: string
                    example: http://example.com/
                  'api:status':
                    type: string
                    example: api:success
        400:
          description: Bad request - invalid IRI or reserved prefix name
        404:
          description: Prefix not found (only when create=false)
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
          
    delete:
      operationId: deletePrefix
      x-python-client: Client::delete_prefix
      x-js-client: Client.deletePrefix
      tags:
        - Database
      summary: Delete a prefix mapping
      description: |
        Remove a prefix from the database.
        
        **When to use:** Clean up unused prefixes or remove deprecated namespace mappings.
        
        **Warning:** Deleting a prefix does NOT delete documents using that prefix. Documents will still reference the full IRI.
        
        **Example:**
        ```bash
        curl -u admin:root -X DELETE \
          http://localhost:6363/api/prefix/admin/mydb/ex
        ```
        
        **Note:** Cannot delete reserved prefixes (@base, @schema, etc.)
      parameters:
        - $ref: '#/components/parameters/organization'
        - $ref: '#/components/parameters/database'
        - name: prefix_name
          in: path
          required: true
          description: The prefix name to delete
          schema:
            type: string
            example: ex
      responses:
        200:
          description: Prefix deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  '@type':
                    type: string
                    example: api:PrefixDeleteResponse
                  'api:prefix_name':
                    type: string
                    example: ex
                  'api:status':
                    type: string
                    example: api:success
        400:
          description: Bad request - reserved prefix cannot be deleted
        404:
          description: Prefix not found
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
  /document/{path}:
    get:
      operationId: getDocuments
      x-python-client: Client::get_documents
      x-js-client: Client.getDocuments
      tags:
        - Document
      summary: Retrieve documents from the database
      description: |
        Retrieve documents from the database. Supports filtering, pagination, and result formatting.
        
        **Examples:**
        ```bash
        # Get all documents
        curl -u admin:root http://localhost:6363/api/document/myorg/mydb
        
        # Get specific document by ID
        curl -u admin:root "http://localhost:6363/api/document/myorg/mydb?ids=Document/abc123"
        
        # Pagination
        curl -u admin:root "http://localhost:6363/api/document/myorg/mydb?skip=10&count=5"

        # Use POST to submit complex queries as JSON instead of URL parameters
        curl -u admin:root -X POST "http://localhost:6363/api/document/myorg/mydb" \
             -H "Content-Type: application/json" \
             -H "X-HTTP-Method-Override: GET" \
             -d '{"ids": ["Document/abc123", "Document/def456"]}'
        ```
        
        **POST Alternative:** Use `X-HTTP-Method-Override: GET` to submit complex queries as JSON instead of URL parameters.
      parameters:
        - $ref: '#/components/parameters/resource_path'
        - $ref: '#/components/parameters/graph_type'
        - name: skip
          in: query
          description: Skip a certain amount of documents
          required: false
          schema:
            type: integer
            default: 0
        - name: count
          in: query
          description: Number of documents to retrieve
          required: false
          schema:
            type: integer
            example: 3
        - name: minimized
          in: query
          description: Minify the output
          required: false
          schema:
            type: boolean
            default: true
        - name: as_list
          in: query
          description: Return the JSONs as list instead of as a json stream
          required: false
          schema:
            type: boolean
            default: false
        - name: unfold
          in: query
          description: Unfold the documents (join other referenced documents)
          schema:
            type: boolean
            default: true
        - name: id
          in: query
          required: false
          description: Specific document ID to look for (takes precedence over ids field)
          schema:
            type: string
            example: Person/Robin_1991-02-01
        - name: ids
          in: query
          required: false
          description: Multiple document IDs to look for, as a json list (EXPERIMENTAL)
          schema:
            type: string
            example: Person/Robin_1991-02-01
        - name: type
          in: query
          required: false
          description: Get documents of only a specific type
          schema:
            type: string
            example: Person
        - name: compress_ids
          in: query
          required: false
          description: Whether to compress all ids using prefixes
          schema:
            type: boolean
            default: true

      responses:
        200:
          description: List or stream of documents
          content:
            application/json:
              schema:
                type: object
                description: Concatenated list of JSON documents
                example: {"@id":"Organization/admin", "@type":"Organization", "database": ["SystemDatabase/system", "UserDatabase/60c35164e937174bbf4dd814c78153d660edc55b3d799c534c1e2d872a3d2dd6" ], "name":"admin"}
        400:
          description: Bad Request
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: Database not found
    post:
      operationId: insertDocument
      x-python-client: Client::insert_document
      x-js-client: Client.addDocument
      tags:
        - Document
      summary: Insert a new document
      description: |
        Add one or more documents to the database. Documents are JSON objects that follow your schema.
        
        **Example:**
        ```bash
        curl -u admin:root -X POST "http://localhost:6363/api/document/admin/mydb?author=admin&message=new+doc" \
             -H "Content-Type: application/json" \
             -d '{"name": "Alice", "age": 30, "@type": "Person"}'
        ```
      parameters:
        - $ref: '#/components/parameters/resource_path'
        - $ref: '#/components/parameters/author'
        - $ref: '#/components/parameters/message'
        - $ref: '#/components/parameters/graph_type'
        - name: full_replace
          in: query
          required: false
          description: Replace the existing data in the graph with the submitted documents. All existing data will be deleted.
          schema:
            type: boolean
            default: false
        - name: raw_json
          in: query
          required: false
          description: Whether to interpret the posted document as arbitrary untyped JSON
          schema:
            type: boolean
            default: false
        - name: require_migration
          in: query
          required: false
          description: Require migration if schema changes
          schema:
            type: boolean
            default: false
        - name: merge_repeats
          in: query
          required: false
          description: Merge repeated values
          schema:
            type: boolean
            default: false
        - name: allow_destructive_migration
          in: query
          required: false
          description: Allow destructive migrations when schema changes
          schema:
            type: boolean
            default: false
      responses:
        200:
          description: Documents added successfully
          content:
            application/json:
              schema:
                type: object
                description: Added documents
        400:
          description: Bad Request
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: Database not found

    delete:
      operationId: deleteDocument
      x-python-client: Client::delete_document
      x-js-client: Client.deleteDocument
      tags:
        - Document
      summary: Delete one or multiple documents
      parameters:
        - $ref: '#/components/parameters/resource_path'
        - $ref: '#/components/parameters/author'
        - $ref: '#/components/parameters/message'
        - $ref: '#/components/parameters/graph_type'
        - name: nuke
          in: query
          description: Remove all data from the graph
          schema:
            type: boolean
            default: false
        - name: id
          in: query
          description: ID of document
          schema:
            type: string
            example: Person/Bert
      responses:
        200:
          description: Document(s) deleted successfully
          # TODO: Need the proper JSON response!
        400:
          description: Bad Request
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: Database not found
    put:
      operationId: replaceDocument
      x-python-client: Client::replace_document
      x-js-client: Client.updateDocument
      tags:
        - Document
      summary: Replace a document
      parameters:
        - $ref: '#/components/parameters/resource_path'
        - $ref: '#/components/parameters/author'
        - $ref: '#/components/parameters/message'
        - $ref: '#/components/parameters/graph_type'
        - name: create
          in: query
          description: Create a document if it does not exist
          required: false
          schema:
            type: boolean
            default: false
        - name: raw_json
          in: query
          description: Treat incoming document as raw json (not type checked)
          required: false
          schema:
            type: boolean
            default: false
        - name: require_migration
          in: query
          required: false
          description: Require migration if schema changes
          schema:
            type: boolean
            default: false
        - name: allow_destructive_migration
          in: query
          required: false
          description: Allow destructive migrations when schema changes
          schema:
            type: boolean
            default: false
      responses:
        200:
          description: Documents replaced successfully
        400:
          description: Bad Request
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: Database not found
  /triples/{path}:
    get:
      operationId: getTriples
      summary: Get RDF triples from a graph
      description: |
        Retrieves RDF triples from the specified graph in Turtle format.
        
        This is a low-level API that provides direct access to the RDF triple layer.
        The entire graph content is returned as raw Turtle RDF data.

        This endpoint is currently experimental. The document API should be used instead. It can be useful for downloading the raw triples for processing though.
        
        **Note:** This endpoint bypasses the JSON-LD document layer and works directly with RDF triples.
      tags:
        - Triples
      parameters:
        - $ref: '#/components/parameters/graph_path'
        - name: format
          in: query
          schema:
            type: string
            enum: [turtle]
            default: turtle
          description: Output format (currently only turtle is supported)
      responses:
        200:
          description: RDF triples in Turtle format
          content:
            text/turtle:
              schema:
                type: string
              example: |
                @prefix ex: <http://example.org/> .
                ex:person1 a ex:Person .
                ex:person1 ex:name "John" .
            application/json:
              schema:
                type: string
              example: "ex:person1 a ex:Person .\nex:person1 ex:name \"John\" ."
        400:
          description: Bad Request
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: Database not found
    post:
      operationId: updateTriples
      summary: Update/Replace RDF triples in a graph
      description: |
        Replaces the entire graph content with the provided RDF triples.
        
        This is a low-level API that operates directly on RDF triples. The operation
        performs a diff between existing and new triples:
        - Deletes all triples that exist in the database but not in the new data
        - Keeps the triples that exist in both the database and the new data
        - Inserts all triples that exist in the new data but not in the database
        
        **Important notes:**
        - The entire graph is processed in one atomic operation
        - Schema validation will be performed if enabled for the database
        - This API cannot correctly create documents with subdocuments
        - Bypasses the JSON document layer and works directly with RDF (warning!)

        **Note:** This endpoint is experimental, here be dragons, use the document API instead.
        It can be useful for loading RDF data into the graph and for pre-processing though.
      tags:
        - Triples
      parameters:
        - $ref: '#/components/parameters/graph_path'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - turtle
                - commit_info
              properties:
                turtle:
                  type: string
                  description: RDF triples in Turtle format
                  example: |
                    @prefix ex: <http://example.org/> .
                    ex:person1 a ex:Person .
                    ex:person1 ex:name "John" .
                    ex:person1 ex:age 30 .
                commit_info:
                  $ref: '#/components/schemas/CommitInfo'
      responses:
        200:
          description: Triples updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TriplesUpdateResponse'
        400:
          description: Bad Request or schema validation failed
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: Database not found
    put:
      operationId: insertTriples
      summary: Insert RDF triples into a graph
      description: |
        Inserts additional RDF triples into the graph without deleting existing ones.
        
        This is a low-level API that adds triples to the existing graph content.
        
        **Important notes:**
        - Inserts the provided triples without removing existing data
        - Does not check for duplicates - may insert the same triple multiple times
        - Schema validation will be performed if enabled for the database
        - This API can't correctly create documents with subdocuments
        - Bypasses the JSON document layer and works directly with RDF

        **Note:** This endpoint is experimental, here be dragons, use the document API instead.
        It can be useful for loading RDF data into the graph and for pre-processing though.
      tags:
        - Triples
      parameters:
        - $ref: '#/components/parameters/graph_path'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - turtle
                - commit_info
              properties:
                turtle:
                  type: string
                  description: RDF triples to insert in Turtle format
                  example: |
                    @prefix ex: <http://example.org/> .
                    ex:person2 a ex:Person .
                    ex:person2 ex:name "Jane" .
                    ex:person2 ex:age 25 .
                commit_info:
                  $ref: '#/components/schemas/CommitInfo'
      responses:
        200:
          description: Triples inserted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TriplesInsertResponse'
        400:
          description: Bad Request or schema validation failed
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: Database not found
  /schema/{path}:
    get:
      operationId: getSchemaFrame
      x-python-client: Client::get_class_frame
      x-js-client: Client.getSchemaFrame
      tags:
        - Frame
      summary: Get the full class frame for a class or all classes for a schema
      parameters:
        - name: path
          description: Path to a specific data product
          in: path
          required: true
          schema:
            type: string
        - name: type
          in: query
          required: false
          description: Class type to get specific frame for
          schema:
            type: string
        - name: compress_ids
          in: query
          description: Compress the URLs returned using prefixes
          required: false
          schema:
            type: boolean
            default: true
        - name: expand_abstract
          in: query
          description: Whether to expand abstract classes into lists of concrete classes in frame options
          required: false
          schema:
            type: boolean
            default: true
      responses:
        200:
          description: Class Frame, or object of all class frames has been successfully returned
          content:
            application/json:
              schema:
                type: object
              examples:
                OneClass:
                  value: { "@documentation": { "@comment":"A normal user database.","@properties": { "comment":"A comment associated with the database.", "creation_date":"The time of creation of the database.", "label":"The label name of the database.", "state":"The system transaction state of the database."} }, "@key": {"@type":"Random"}, "@type":"Class", "comment":"xsd:string", "creation_date":"xsd:dateTime","label":"xsd:string","name":"xsd:string","state": {"@id":"DatabaseState","@type":"Enum","@values": ["creating", "deleting", "finalized" ]}}
                AllClasses:
                  value: { "@context": { "@base":"terminusdb:///data/", "@schema":"terminusdb:///schema#", "@type":"Context" }, "Person": {"@type":"Class", "name":"xsd:string"}, "Room": {"@type":"Class", "room_number":"xsd:integer"} }
        400:
          description: Bad Request
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: Database not found
  /woql:
    post:
      operationId: executeWoqlQuery
      summary: Execute a WOQL query
      description: |
        Run Web Object Query Language (WOQL) queries for complex data operations including on triples. Use SDK in Javascript, Python or Rust to make it easy to construct the queries.
        
        **Example:**
        ```json
        {
          "@type": "Query",
          "@query": {
            "@type": "And",
            "@graph": [
              {
                "@type": "Triple",
                "subject": { "@type": "Variable", "variable_name": "person" },
                "predicate": "rdf:type",
                "object": "schema:Person"
              },
              {
                "@type": "Triple",
                "subject": { "@type": "Variable", "variable_name": "person" },
                "predicate": "schema:name",
                "object": { "@type": "Variable", "variable_name": "name" }
              }
            ]
          }
        }
        ```
      x-python-client: Client::woql_query
      x-js-client: Client.woqlQuery
      tags:
        - WOQL
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WoqlQuery'
      responses:
        200:
          description: Query result
        400:
          description: Bad Request
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
  /woql/{path}:
    post:
      operationId: executeWoqlQueryForDatabase
      summary: Execute a WOQL query for a specific database
      x-python-client: Client::query
      x-js-client: Client.query
      tags:
        - WOQL
      parameters:
        - name: path
          description: Database Path
          in: path
          required: true
          schema:
            type: string
            example: admin/foo
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WoqlQuery'
      responses:
        200:
          description: Query result
        400:
          description: Bad Request
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: Database not found
  /clone/{organization}/{database}:
    post:
      operationId: cloneDatabase
      summary: Clone a database
      description: |
        Create a copy of an existing database. Useful for creating development environments or backups.
        
        **Example:**
        ```bash
        curl -u admin:root -X POST http://localhost:6363/api/clone/admin/mydb_clonedx \
             -H "Content-Type: application/json" \
             -H "Authorization-Remote: Basic YWRtaW46cm9vdA==" \
             -d '{"remote_url": "http://localhost:6363/admin/mydb", "comment": "Clone for testing", "label": "Cloned DB"}'
        ```
      x-python-client: Client::clonedb
      x-js-client: Client.clonedb
      tags:
        - Collaboration
      parameters:
        - $ref: '#/components/parameters/organization'
        - $ref: '#/components/parameters/database'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - comment
                - label
                - remote_url
              properties:
                comment:
                  type: string
                  example: This is a comment on my cloned database
                  description: The comment to use in the cloned database
                label:
                  type: string
                  example: This is how I label my cloned database
                  description: The label to use for the cloned database
                remote_url:
                  type: string
                  example: 'http://cloud.terminusdb.com/TerminatorsX/TerminatorsX/nuclear'
                  description: The URL of the database to clone
                public:
                  type: boolean
                  description: Whether to make the newly cloned database public
      responses:
        200:
          description: Database cloned successfully
          content:
            application/json:
              schema:
                type: object
        400:
          description: Bad Request
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: Database not found
  /fetch/{path}:
    post:
      operationId: fetchRemote
      x-python-client: Client::fetch
      x-js-client: Client.fetch
      tags:
        - Collaboration
      summary: Fetch the remote repository for the given path (default is origin)
      parameters:
        - $ref: '#/components/parameters/branch_path'
        - name: AUTHORIZATION_REMOTE
          in: header
          required: true
          description: The authorization to use on the remote
          schema:
            type: string
            example: Basic S2FybEthdXRza3k6cGFzc3dvcmRfZGVzdGluYXRpb24=
      responses:
        200:
          description: "Successful fetch"
          content:
            application/json:
              schema:
                type: object
                properties:
                  "@type:":
                    type: string
                    enum:
                      - "api:FetchRequest"
                  "api:status":
                    type: string
                    enum:
                      - "api:success"
                  "api:head_has_changed":
                    type: boolean
                  "api:head":
                    type: string
                    example: 194822f8942286517e151817d38acca4c9ac7d01
        400:
          description: Bad Request
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: Database not found
  /push/{path}:
    post:
      operationId: pushBranch
      x-python-client: Client::push
      x-js-client: Client.push
      summary: Push the branch to the remote
      tags:
        - Collaboration
      parameters:
        - $ref: '#/components/parameters/branch_path'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - remote
                - remote_branch
              properties:
                remote:
                  type: string
                  example: origin
                  description: The name of the remote to push to
                remote_branch:
                  type: string
                  example: main
                  description: The name of the branch on the remote to push
                push_prefixes:
                  type: boolean
                  default: false
                  description: Should the prefixes also be pushed to the remote?
      responses:
        200:
          description: "Push Response"
          content:
            application/json:
              schema:
                type: object
                properties:
                  "@type":
                    type: string
                    enum:
                      - "api:PushResponse"
                  "api:repo_head_updated":
                    type: boolean
                  "api:repo_head":
                    type: string
                    example: 194822f8942286517e151817d38acca4c9ac7d01
                  "api:status":
                    type: string
                    enum:
                      - "api:success"
        400:
          description: "Push Response"
          content:
            application/json:
              schema:
                type: object
                properties:
                  "@type":
                    type: string
                    enum:
                      - "api:PushErrorResponse"
                  "api:error":
                    type: object
                  "api:message":
                    type: string
                    example: "Unknown remote repository: porridgen"
                  "api:status":
                    type: string
                    enum:
                      - "api:failure"

  /pull/{path}:
    post:
      operationId: pullBranch
      x-python-client: Client::pull
      x-js-client: Client.pull
      summary: Pull to a branch from a remote
      tags:
        - Collaboration
      parameters:
        - $ref: '#/components/parameters/branch_path'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - remote
                - remote_branch
              properties:
                remote:
                  type: string
                  example: origin
                  description: The name of the remote to push to
                remote_branch:
                  type: string
                  example: main
                  description: The name of the branch on the remote to push
      responses:
        200:
          description: "Pull Response"
          content:
            application/json:
              schema:
                type: object
                properties:
                  "@type":
                    type: string
                    enum:
                      - "api:PullResponse"
                  "api:status":
                    type: string
                    enum:
                      - "api:success"
        400:
          description: Bad Request
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: Database not found
  /remote/{path}:
    post:
      operationId: createRemote
      x-python-client: not_implemented
      x-js-client: not_implemented
      summary: Create a new remote
      tags:
        - Collaboration
      parameters:
        - $ref: '#/components/parameters/branch_path'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - remote_name
                - remote_location
              properties:
                remote_name:
                  type: string
                  example: origin
                  description: The name of the remote
                remote_location:
                  type: string
                  example: 'http://cloud.terminusdb.com/TerminatorsX/TerminatorsX/nuclear'
                  description: The URI to associate with the remote
      responses:
        200:
          description: "Remote update success"
          content:
            application/json:
              schema:
                type: object
                properties:
                  "@type":
                    type: string
                    enum:
                      - "api:RemoteResponse"
                  "api:status":
                    type: string
                    enum:
                      - "api:success"
        400:
          description: Bad Request
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: Database not found
    delete:
      operationId: deleteRemote
      x-python-client: not_implemented
      x-js-client: not_implemented
      summary: Delete a remote
      tags:
        - Collaboration
      parameters:
        - $ref: '#/components/parameters/branch_path'
        - name: remote_name
          in: query
          schema:
            type: string
            example: origin
          description: The name of the remote
      responses:
        200:
          description: "Remote delete success"
          content:
            application/json:
              schema:
                type: object
                properties:
                  "@type":
                    type: string
                    enum:
                      - "api:RemoteResponse"
                  "api:status":
                    type: string
                    enum:
                      - "api:success"
        400:
          description: Bad Request
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: Database not found
    put:
      operationId: updateRemote
      x-python-client: not_implemented
      x-js-client: not_implemented
      summary: Update a remote with a new location
      tags:
        - Collaboration
      parameters:
        - $ref: '#/components/parameters/branch_path'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - remote_name
                - remote_location
              properties:
                remote_name:
                  type: string
                  example: origin
                  description: The name of the remote
                remote_location:
                  type: string
                  example: 'http://cloud.terminusdb.com/TerminatorsX/TerminatorsX/nuclear'
                  description: The URI to associate with the remote
      responses:
        200:
          description: "Remote update success"
          content:
            application/json:
              schema:
                type: object
                properties:
                  "@type":
                    type: string
                    enum:
                      - "api:RemoteResponse"
                  "api:status":
                    type: string
                    enum:
                      - "api:success"
        400:
          description: Bad Request
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: Database not found
    get:
      operationId: getRemote
      x-python-client: not_implemented
      x-js-client: not_implemented
      summary: Get the url for a given remote
      tags:
        - Collaboration
      parameters:
        - $ref: '#/components/parameters/branch_path'
        - name: remote_name
          in: query
          schema:
            type: string
            example: origin
      responses:
        200:
          description: "Remote delete success"
          content:
            application/json:
              schema:
                type: object
                properties:
                  "@type":
                    type: string
                    enum:
                      - "api:RemoteResponse"
                  "api:remote_name":
                    type: string
                    example: origin
                  "api:remote_url":
                    type: string
                    example: 'http://cloud.terminusdb.com/TerminatorsX/TerminatorsX/nuclear'
                  "api:status":
                    type: string
                    enum:
                      - "api:success"
        400:
          description: Bad Request
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: Database not found
        409:
          description: Conflict
  /branch/{path}:
    post:
      operationId: createBranch
      summary: Create a new branch
      x-python-client: Client::create_branch
      x-js-client: Client.branch
      tags:
        - Branches
      parameters:
        - $ref: '#/components/parameters/branch_path'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        200:
          description: "Branch created successfully"
          content:
            application/json:
              schema:
                type: object
                properties:
                  "@type":
                    type: string
                    enum:
                      - "api:BranchResponse"
                  "api:status":
                    type: string
                    enum:
                      - "api:success"
        400:
          description: Bad Request
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: Database not found
    delete:
      operationId: deleteBranch
      summary: Delete a branch
      x-python-client: Client::delete_branch
      x-js-client: Client.deleteBranch
      tags:
        - Branches
      parameters:
        - $ref: '#/components/parameters/branch_path'
      responses:
        200:
          description: "Branch deleted successfully"
          content:
            application/json:
              schema:
                type: object
                properties:
                  "@type":
                    type: string
                    enum:
                      - "api:BranchResponse"
                  "api:status":
                    type: string
                    enum:
                      - "api:success"
        400:
          description: Bad Request
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: Branch not found

  /squash/{path}:
    x-python-client: Client::squash
    x-js-client: Client.squashBranch
    parameters:
        - $ref: '#/components/parameters/commit_path'
    post:
      operationId: squashCommits
      summary: Squash a commit history into a new commit
      description: This squashes a commit history into a single commit. The commit will not be attached to any particular branch.
      tags:
        - Branches
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - "commit_info"
              properties:
                "commit_info":
                  $ref: "#/components/schemas/CommitInfo"
      responses:
        200:
          description: |
            Successfully created a new unattached commit containing the squashed data. This commit can be queried directly, or be assigned to a particular branch using the reset endpoint.
            
            **Workflow Example:**
            ```bash
            # 1. Squash multiple commits into one
            curl -u admin:root -X POST "http://localhost:6363/api/squash/admin/mydb" \
                 -H "Content-Type: application/json" \
                 -d '{"commit_info": {"author": "admin", "message": "Squashed feature branch"}}'
            
            # 2. Reset branch to the new squashed commit (drops commit history, replaced by squashed commit)
            curl -u admin:root -X POST "http://localhost:6363/api/reset/admin/mydb" \
                 -H "Content-Type: application/json" \
                 -d '{"commit_info": {"author": "admin", "message": "Reset to squashed commit"}, "commit_descriptor": "admin/mydb/local/commit/c0dmv6t9nn3zbg2n7lbi4ynpaz42jfd"}'
            ```
          content:
            application/json:
              schema:
                type: object
                properties:
                  "@type":
                    type: string
                    enum:
                      - "api:SquashResponse"
                  "api:commit":
                    type: string
                    description: the newly generated commit
                    example: admin/test/local/commit/apgatilsa03g4lsa9ra5698wom5wcv7
                  "api:old_commit":
                    type: string
                    description: the commit that was squashed
                    example: admin/test/local/commit/5jndjh9lexe62q9u1q2vofyjemfnmyt
                  "api:status":
                    type: string
                    enum:
                    - api:success
        400:
          description: Bad Request
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: Database not found
  /reset/{path}:
    parameters:
      - $ref: '#/components/parameters/branch_path'
    post:
      operationId: resetBranch
      summary: Reset branch to a specific commit
      description: This will set the branch to the submitted commit. The commit is specified as a resource path to either a specific commit, or to a branch, in which case the commit this branch will be set to is going to be the head of that branch.
      x-python-client: Client::reset
      x-js-client: Client.resetBranch
      tags:
        - Branches
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                commit_descriptor:
                  type: string
                  description: path to a specific commit or to a branch
                  example: admin/test/local/commit/5jndjh9lexe62q9u1q2vofyjemfnmyt
      responses:
        200:
          description: "Successfully reset branch HEAD to commit_descriptor"
          content:
            application/json:
              schema:
                type: object
                properties:
                  "@type":
                    type: string
                    enum:
                      - api:ResetResponse
                  "api:status":
                    type: string
                    enum:
                      - api:success
        400:
          description: Bad Request
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: Database not found
  /rebase/{path}:
    parameters:
      - $ref: '#/components/parameters/branch_path'
    post:
      operationId: rebaseBranch
      summary: Rebase all commits from a source onto this branch
      description: |
          Given a submitted commit ref (either a branch path or a commit path), this will find out the most recent common commit, and starting at that common commit, reapply commits from the source, followed by the commits from this branch. The end result is a history where all changes unique to this branch are now at the top of the history.

          If there is no common history, the rebase will take all commits into account.
          
          **Example:**
          ```bash
          curl -u admin:root -X POST "http://localhost:6363/api/rebase/admin/mydb" \
               -H "Content-Type: application/json" \
               -d '{"author": "admin", "rebase_from": "admin/feature_branch"}'
          ```
      x-python-client: Client::rebase
      x-js-client: Client.rebase
      tags:
        - Branches
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                author:
                  type: string
                  example: Lightning McQueen
                rebase_from:
                  type: string
                  example: admin/test/local/branch/bar
      responses:
        200:
          description: "Successfully rebased commits"
          content:
            application/json:
              schema:
                type: object
                properties:
                  "@type":
                    type: string
                    enum:
                      - api:RebaseResponse
                  "api:forwarded_commits":
                    type: array
                    items:
                      type: string
                    description: the list of ids that are taken from source
                    example:
                      - q0r08e1hjy123tkf0urzjiov7rrnmp7
                      - 71oqhojpu24a1doftlo9szjkmf22yhy
                  "api:rebase_report":
                    description: a report for each rebased commit on how it was reapplied
                    type: array
                    items:
                      type: object
                      properties:
                        "@type":
                          type: string
                          enum:
                            - api:RebaseReport
                        "api:origin_commit":
                          type: string
                          description: the original commit ID
                        "api:applied":
                          type: array
                          items:
                            type: string
                          description: the new commit IDs this commit turned into
                        "api:commit_type":
                          type: string
                          enum:
                            - api:valid_commit
                    example:
                      - '@type': api:RebaseReport
                        api:applied:
                          - 1q7oa1tq79w2hbn21b6bp7gojryqdes
                        api:commit_type: api:valid_commit
                        api:origin_commit: wguh7angj0wyc7zmolzf8r9p80s6wz6
                      - '@type': api:RebaseReport
                        api:applied:
                          - i2e1wv5pagftoguf70yrk66ufogrejf
                        api:commit_type: api:valid_commit
                        api:origin_commit: w1akvg7nvbzgkqj4ycugftk9g1d1ydy
                      - '@type': api:RebaseReport
                        api:applied:
                          - ams38vxkl0yphl9ni0hgkb4802arm3s
                        api:commit_type: api:valid_commit
                        api:origin_commit: opk0hv1qk6j0q7auaexlkisd6mf28s9
                  "api:common_commit_id":
                    type: string
                    example: h9m7xx0c4lyhpp6kf728yfcotyxmodn
                  "api:status":
                    type: string
                    enum:
                      - api:success
        400:
          description: Bad Request
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: Database not found
  /optimize/{path}:
    post:
      operationId: optimizeGraph
      summary: Optimize a specific graph
      x-python-client: Client::optimize
      x-js-client: Client.optimizeBranch
      description: |
          Optimize the database graph structure for improved query performance. This operation merges layers to reduce historical layers traversal costs and compacts the storage to reduce fragmentation.
          
          **Example:**
          ```bash
          curl -u admin:root -X POST "http://localhost:6363/api/optimize/admin/mydb"
          ```
      tags:
        - Optimize
      parameters:
        - name: path
          description: Database Path
          in: path
          required: true
          schema:
            type: string
            example: _system
      responses:
        200:
          description: Successfully optimized resource
          content:
            application/json:
              schema:
                type: object
                properties:
                  "@type":
                    type: string
                    enum:
                      - api:OptimizeResponse
                  "api:status":
                    type: string
                    enum:
                      - api:success
        400:
          description: Bad Request
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: Database not found
  /prefixes/{path}:
    get:
      operationId: getPrefixes
      summary: Get prefixes
      x-python-client: Client::_get_prefixes
      x-js-client: Client.getPrefixes
      tags:
        - Prefixes
      parameters:
        - name: path
          description: Database Path
          in: path
          required: true
          schema:
            type: string
            example: _system
      responses:
        200:
          description: "Successfully fetched prefixes of graph"
          content:
            application/json:
              schema:
                type: object
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: Database not found
  /diff:
    post:
      operationId: diffVersions
      summary: Diff a specific object or two data versions
      x-python-client: Client::diff
      x-js-client: Client.getVersionDiff, Client.getVersionObjectDiff
      description: |
          Diff a specific object or two data versions in the commit history.
          
          **Example:**
          ```bash
          curl -u admin:root -X POST "http://localhost:6363/api/diff" \
               -H "Content-Type: application/json" \
               -d '{
                 "before": {"@id": "Person/Jane", "@type": "Person", "name": "Jane"},
                 "after": {"@id": "Person/Jane", "@type": "Person", "name": "Jannet"}
               }'
          ```
      tags:
        - Change management
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                "before":
                  type: object
                  example: { "@id" : "Person/Jane", "@type" : "Person", "name" : "Jane"}
                "after":
                  type: object
                  example: { "@id" : "Person/Jane", "@type" : "Person", "name" : "Jannet"}
                "before_data_version":
                  type: string
                  example: ow5ysf361fc2o6qf3aqn7twuuhbzi1
                "after_data_version":
                  type: string
                  example: sxs3t5ua25yydnn5scfcr32uy4m19wt
                "document_id":
                  type: string
                  example: Person/Jane
                "start":
                  type: integer
                  example: 0
                "count":
                  type: integer
                  example: 10
                "keep":
                  type: object
                  example: { "@id" : true, "_id" : true }
      responses:
        200:
          description: "Successful Diff"
          content:
            application/json:
              schema:
                type: object
                example: { "name" : { "@op" : "ValueSwap", "@before" : "Jane", "@after": "Janine" }}
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: "Failed to find diff"

  /patch:
    post:
      operationId: applyPatch
      summary: Apply a patch object to another object (diff result)
      x-python-client: Client::patch
      x-js-client: Client.patch
      description: |
          Apply a patch object to another object. Typically used with the result from the diff endpoint to apply changes.
          
          **Example:**
          ```bash
          curl -u admin:root -X POST "http://localhost:6363/api/patch" \
               -H "Content-Type: application/json" \
               -d '{
                 "before": {"@id": "Person/Jane", "@type": "Person", "name": "Jane"},
                 "patch": {"name": {"@op": "SwapValue", "@before": "Jane", "@after": "Jannet"}}
               }'
          ```
      tags:
        - Change management
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                "before":
                  type: object
                  example: { "@id" : "Person/Jane", "@type" : "Person", "name" : "Jane"}
                "patch":
                  type: object
                  example: { "name" : { "@op" : "ValueSwap", "@before" : "Jane", "@after": "Janine" }}
      responses:
        200:
          description: "Successful Patch"
          content:
            application/json:
              schema:
                type: object
                example: { "@id" : "Person/Jane", "@type" : "Person", "name" : "Jannet"}
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: "Failed to apply patch: returning conflict patch"
          content:
            application/json:
              schema:
                type: object
                example: { "name" : { "@op" : "ValueSwap", "@before" : "Doug", "@after": "Jane" }}
  /patch/{path}:
    parameters:
      - $ref: '#/components/parameters/branch_path'
    post:
      operationId: patchResource
      summary: Apply a patch object to a resource
      description: |
          Apply a patch object to a resource in the database. Can be used to modify schema elements, documents, or prefixes.
          
          **Example:**
          ```bash
          curl -u admin:root -X POST "http://localhost:6363/api/patch" \
               -H "Content-Type: application/json" \
               -d '{
                 "before": {"@id": "Person/Jane", "@type": "Person", "name": "Jane"},
                 "patch": {"name": {"@op": "SwapValue", "@before": "Jane", "@after": "Jannet"}}
               }'
          ```
      x-python-client: Client::patch_resource
      x-js-client: Client.patchResource
      tags:
        - Change management
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: 
                - "patch"
                - "author"
                - "message"
              properties:
                "patch":
                  type: array
                  items:
                    type: object
                  example:
                    - '@id': Obj/id1
                      name:
                        '@op': SwapValue
                        '@before': foo
                        '@after': bar
                    - '@id': Obj/id2
                      name:
                        '@op': SwapValue
                        '@before': foo
                        '@after': bar
                "author": 
                  type: string
                  example: me
                "message": 
                  type: string
                  example: message
      responses:
        200:
          description: "Patch applied cleanly"
          content:
            application/json:
              schema:
                type: array
                items: 
                  type: string
                example: ["Obj/id1", "Obj/id2"]
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: Database not found
        409:
          description: "Failed to apply patch: returning conflict patch"
          content:
            application/json:
              schema:
                type: object
                example: { "@type" : "api:PatchError", "api:status" : "api:conflict", "api:witnesses" : [{"@op" : "InsertConflict", "@id_already_exists" : "Person/Jane"}]}
  /apply/{path}:
    parameters:
      - $ref: '#/components/parameters/branch_path'
    post:
      operationId: applyDiff
      summary: Apply a specific diff
      x-python-client: Client::apply
      x-js-client: Client.apply
      tags:
        - Change management
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - "before_commit"
                - "after_commit"
                - "commit_info"
              properties:
                "before_commit":
                  type: object
                  example: { "@id" : "Person/Jane", "@type" : "Person", "name" : "Jane"}
                "after_commit":
                  type: object
                  example: { "name" : { "@op" : "ValueSwap", "@before" : "Jane", "@after": "Janine" }}
                "commit_info":
                  $ref: "#/components/schemas/CommitInfo"
                "match_final_state":
                  type: boolean
                  default: false
                "keep":
                  type: object
                  example: { "@id" : true, "_id" : true }
      responses:
        200:
          description: "Successful Patch Application"
          content:
            application/json:
              schema:
                type: object
                example: {"@type" : "api:ApplyResponse", "api:status" : "api:success" }
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: Database not found
        409:
          description: "Failed to apply patch: returning conflict patch"
          content:
            application/json:
              schema:
                type: object
                example: { "@type" : "api:ApplyError", "api:status" : "api:conflict", "api:witnesses" : [{"@op" : "InsertConflict", "@id_already_exists" : "Person/Jane"}]}
  /log/{organization}/{database}:
    get:
      operationId: getCommitLog
      x-python-client: Client::log
      x-js-client: not_implemented
      summary: "Get commits from a specific database or branch"
      tags:
        - Change management
      parameters:
        - $ref: '#/components/parameters/organization'
        - $ref: '#/components/parameters/database'
        - name: start
          description: Index to start from
          in: query
          required: false
          schema:
            type: integer
            example: 0
        - name: count
          description: Amount of commits to show
          in: query
          required: false
          schema:
            type: integer
            example: 10
      responses:
        200:
          description: "Successful log request"
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    "@id":
                      type: string
                      example: InitialCommit/hpl18q42dbnab4vzq8me4bg1xn8p2a0
                    "@type":
                      type: string
                      example: InitialCommit
                    "author":
                      type: string
                      example: admin
                    "identifier":
                      type: string
                      example: hpl18q42dbnab4vzq8me4bg1xn8p2a0
                    "message":
                      type: string
                      example: create initial schema
                    "schema":
                      type: string
                      example: layer_data:Layer_4234adfe377fa9563a17ad764ac37f5dcb14de13668ea725ef0748248229a91b
                    "timestamp":
                      type: number
                      example: 1660919664.9129035
                  example: {"@type" : "api:ApplyResponse", "api:status" : "api:success" }
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: Database not found
  /history/{organization}/{database}:
    get:
      operationId: getDocumentHistory
      x-python-client: not_implemented
      x-js-client: not_implemented
      summary: "Get commits from a specific database or branch"
      tags:
        - Change management
      parameters:
        - $ref: '#/components/parameters/organization'
        - $ref: '#/components/parameters/database'
        - name: id
          description: id of document to report history of
          in: query
          required: true
          schema:
            type: string
            example: "A/0"
        - name: start
          description: Index to start from
          in: query
          required: false
          schema:
            type: integer
            example: 0
        - name: updated
          description: Last updated time (excludes history, but can be combined with created)
          in: query
          required: false
          schema:
            type: boolean
        - name: created
          description: Created date of object (excludes history, but can be combined with updated)
          in: query
          required: false
          schema:
            type: boolean
        - name: count
          description: Amount of commits to show
          in: query
          required: false
          schema:
            type: integer
            example: 10
      responses:
        200:
          description: "Successful history request"
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    "author":
                      type: string
                      example: admin
                    "identifier":
                      type: string
                      example: hpl18q42dbnab4vzq8me4bg1xn8p2a0
                    "message":
                      type: string
                      example: create initial schema
                    "timestamp":
                      type: number
                      example: 1660919664.9129035
        400:
          description: Bad Request
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: Database not found
  /roles:
    post:
      operationId: createRole
      x-python-client: Client::add_role
      x-js-client: AccessControl.createRole
      tags:
        - Account management
      summary: Adding a new role
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - "name"
                - "action"
              properties:
                "name":
                  type: string
                  example: 'Grand Pubah'
                "action":
                  type: array
                  items:
                    type: string
                    example: "branch"
                  example: ["branch","class_frame","clone","commit_read_access","commit_write_access","create_database","delete_database","fetch","instance_read_access","instance_write_access","manage_capabilities","meta_read_access","meta_write_access","push","rebase","schema_read_access","schema_write_access"]
      responses:
        200:
          description: "Successfully added role"
          content:
            application/json:
              schema:
                type: string
                example: "Role/Grand%20Pubah"
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        400:
          description: Bad Request
    put:
      operationId: updateRole
      x-python-client: Client::change_role
      x-js-client: not_implemented
      tags:
        - Account management
      summary: Changing actions for a role
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - "name"
                - "action"
              properties:
                "name":
                  type: string
                  example: 'Grand Pubah'
                "action":
                  type: array
                  items:
                    type: string
                    example: "branch"
                  example: ["branch","class_frame","clone","commit_read_access","commit_write_access","create_database","delete_database","fetch","instance_read_access","instance_write_access","manage_capabilities","meta_read_access","meta_write_access","push","rebase","schema_read_access","schema_write_access"]
      responses:
        200:
          description: "Successfully updated role"
          content:
            application/json:
              schema:
                type: object
                example: {"@type" : "api:RolesResponse", "api:status" : "api:success"}
        404:
          description: Not Found
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        400:
          description: Bad Request
    get:
      operationId: getRoles
      x-python-client: Client::get_available_roles
      x-js-client: AccessControl.getAccessRoles
      tags:
        - Account management
      summary: Get all roles available with the current authority
      responses:
        200:
          description: "Listing of all roles"
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                example: [{"@id":"Role/admin","@type":"Role","action":["branch","class_frame","clone","commit_read_access","commit_write_access","create_database","delete_database","fetch","instance_read_access","instance_write_access","manage_capabilities","meta_read_access","meta_write_access","push","rebase","schema_read_access","schema_write_access"],"name":"Admin Role"},{"@id":"Role/consumer","@type":"Role","action":["class_frame","instance_read_access","schema_read_access"],"name":"ConsumerRole"}]
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
  /roles/{roleName}:
    delete:
      operationId: deleteRole
      x-python-client: not_implemented
      x-js-client: AccessControl.deleteRole
      summary: Delete a role
      tags:
        - Account management
      parameters:
        - name: roleName
          in: path
          required: true
          schema:
            type: string
            example: Editor
      responses:
        200:
          description: "Successfully deleted role"
          content:
            application/json:
              schema:
                type: object
                example: {"@type" : "api:RolesResponse", "api:status" : "api:success"}
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: Not Found
          content:
            application/json:
              schema:
                type: object
                example: {"@type":"api:RoleErrorResponse","api:error": {"@type":"api:DocumentNotFound", "api:document_id":"Role/Garbage"},"api:message":"Document not found: 'Role/Editor'","api:status":"api:not_found"}
    get:
      operationId: getRole
      x-python-client: not_implemented
      x-js-client: not_implemented
      tags:
        - Account management
      summary: Get the role object by role name
      parameters:
        - name: roleName
          in: path
          required: true
          schema:
            type: string
            example: Consumer Role
      responses:
        200:
          description: "Successfully aquired role"
          content:
            application/json:
              schema:
                type: object
                example: {"@id":"Role/consumer","@type":"Role","action": ["class_frame", "instance_read_access", "schema_read_access" ],"name":"Consumer Role"}
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        404:
          description: Not Found
          content:
            application/json:
              schema:
                type: object
                example: {"@type":"api:RoleErrorResponse","api:error": {"@type":"api:DocumentNotFound", "api:document_id":"Role/Garbage"},"api:message":"Document not found: 'Role/Editor'","api:status":"api:not_found"}
  /organizations:
    get:
      operationId: getOrganizations
      x-python-client: Client::get_organizations
      x-js-client: AccessControl.getAllOrganizations
      tags:
        - Account management
      summary: Get all organizations according to the capabilities of the user
      responses:
        200:
          description: Succesful listing of organizations
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                example: [{"@id":"Organization/admin","@type":"Organization","database": ["SystemDatabase/system",  "UserDatabase/326f41af8c9499b0eea69b67fdced3efbd31663ca601dee8c50d3ad3393b367d","UserDatabase/462333349c1a8271aca185a3bd2d601057fdf2584a88687ad55e43cab635da48","UserDatabase/b4e01001e90bd368f8f19640426f346970f5ceb8eb02acaa42c759f3758e1901","UserDatabase/f5a0ef94469b32e1aee321678436c7dfd5a96d9c476672b3282ae89a45b5200e"],"name":"admin"}]
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
  /organizations/{organizationName}:
    parameters:
      - name: organizationName
        in: path
        required: true
        schema:
          type: string
          example: admin
    get:
      operationId: getOrganization
      x-python-client: Client::get_organization
      x-js-client: not_implemented
      tags:
        - Account management
      summary: Get the organization object by name
      description: |
        Retrieves the organization object and the databases of the organization.
      responses:
        200:
          description: "Successfully aquired organization"
          content:
            application/json:
              schema:
                type: object
                example: {"@id":"Organization/admin","@type":"Organization","database": ["SystemDatabase/system",  "UserDatabase/326f41af8c9499b0eea69b67fdced3efbd31663ca601dee8c50d3ad3393b367d","UserDatabase/462333349c1a8271aca185a3bd2d601057fdf2584a88687ad55e43cab635da48","UserDatabase/b4e01001e90bd368f8f19640426f346970f5ceb8eb02acaa42c759f3758e1901","UserDatabase/f5a0ef94469b32e1aee321678436c7dfd5a96d9c476672b3282ae89a45b5200e"],"name":"admin"}
        404:
          description: Not Found
          content:
            application/json:
              schema:
                type: object
                example: {"@type":"api:OrganizationErrorResponse","api:error":{"@type":"api:NoIdForOrganizationName","api:organization_name":"Garbage"},"api:message":"There is no organization with the name adsdfmin.","api:status":"api:not_found"}
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
    post:
      operationId: createOrganization
      x-python-client: Client::create_organization
      x-js-client: AccessControl.createOrganization
      tags:
        - Account management
      summary: Add an organization with the given name
      description: |
        Creates a new organization with the specified name. The organization name is provided in the URL path parameter.
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties: {}
      responses:
        200:
          description: "Successfully added organization"
          content:
            application/json:
              schema:
                type: string
                example: terminusdb://system/data/Organization/admin
        400:
          description: Bad Request
          content:
            application/json:
              schema:
                type: object
                example: {"@type":"api:OrganizationErrorResponse","api:error": {"@type":"api:NoUniqueIdForOrganizationName","api:organization_id":"terminusdb://system/data/Organization/admin"},"api:message":"An organization with the id 'terminusdb://system/data/Organization/admin' already exists.  Consider renaming, deleting the old role, or updating the old role.","api:status":"api:failure"}
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
    delete:
      operationId: deleteOrganization
      x-python-client: Client::delete_organization
      x-js-client: AccessControl.deleteOrganization
      tags:
        - Account management
      summary: Delete the organization of the given name
      responses:
        200:
          description: "Successfully deleted organization"
          content:
            application/json:
              schema:
                type: object
                example: {'@type':"api:OrganizationResponse",'api:status':"api:success"}
        400:
          description: Bad Request
          content:
            application/json:
              schema:
                type: object
                example: {"@type":"api:OrganizationErrorResponse","api:error": {"@type":"api:NoUniqueIdForOrganizationName","api:organization_id":"terminusdb://system/data/Organization/admin"},"api:message":"An organization with the id 'terminusdb://system/data/Organization/admin' already exists.  Consider renaming, deleting the old role, or updating the old role.","api:status":"api:failure"}
  /organizations/{organizationName}/users:
    parameters:
      - name: organizationName
        in: path
        required: true
        schema:
          type: string
          example: admin
    get:
      operationId: getOrganizationUsers
      x-python-client: Client::get_organization_users
      x-js-client: AccessControl.getOrgUsers
      tags:
        - Account management
      summary: Get all available users according to capabilities within an organization
      responses:
        200:
          description: "Successfully listing users in organization"
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  description: Users with their capabilities
                example: [{"@id":"User/admin","capability":[{"@id":"Capability/server_access","@type":"Capability","role":[{"@id":"Role/admin","@type":"Role","action":["branch","class_frame","clone","commit_read_access","commit_write_access","create_database","delete_database","fetch","instance_read_access","instance_write_access","manage_capabilities","meta_read_access","meta_write_access","push","rebase","schema_read_access","schema_write_access"],"name":"AdminRole"}],"scope":"Organization/admin"}],"name":"admin"}]
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        400:
          description: Bad Request
  /organizations/{organizationName}/users/{userName}:
    get:
      operationId: getOrganizationUser
      x-python-client: Client::get_organization_user
      x-js-client: not_implemented
      tags:
        - Account management
      summary: Get a user record for a given organization
      parameters:
        - name: organizationName
          in: path
          required: true
          schema:
            type: string
            example: admin
        - name: userName
          in: path
          required: true
          schema:
            type: string
            example: admin
      responses:
        200:
          description: "Successfully listing users in organization"
          content:
            application/json:
              schema:
                type: object
                example: {"@id":"User/admin","capability":[{"@id":"Capability/server_access","@type":"Capability","role":[{"@id":"Role/admin","@type":"Role","action":["branch","class_frame","clone","commit_read_access","commit_write_access","create_database","delete_database","fetch","instance_read_access","instance_write_access","manage_capabilities","meta_read_access","meta_write_access","push","rebase","schema_read_access","schema_write_access"],"name":"AdminRole"}],"scope":"Organization/admin"}],"name":"admin"}
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        400:
          description: Bad Request
  /organizations/{organizationName}/users/{userName}/databases:
    get:
      operationId: getOrganizationUserDatabases
      x-python-client: Client::get_organization_user_databases
      x-js-client: not_implemented
      tags:
        - Account management
      summary: Get the databases available to a user which are inside an organization
      parameters:
        - name: organizationName
          in: path
          required: true
          schema:
            type: string
            example: admin
        - name: userName
          in: path
          required: true
          schema:
            type: string
            example: admin
      responses:
        200:
          description: "Successfully listing users in organization"
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  example: {"@id":"SystemDatabase/system","@type":"SystemDatabase","name":"_system"}
                example: [{"@id":"SystemDatabase/system","@type":"SystemDatabase","name":"_system"}]
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
        400:
          description: Bad Request
  /users:
    get:
      operationId: getUsers
      x-python-client: Client::get_users
      x-js-client: AccessControl.getAllUsers
      tags:
        - Account management
      summary: Get all users according to capabilities of the authenticated user
      parameters:
        - name: capability
          in: query
          description: Get capabilities for the listed users
          schema:
            type: boolean
            default: false
      responses:
        200:
          description: Success at listing users
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  example: {"@id":"User/admin","@type":"User","capability":["Capability/server_access"],"name":"admin"}
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
    put:
      operationId: changeUserPassword
      x-python-client: Client::change_user_password
      x-js-client: not_implemented
      tags:
        - Account management
      summary: Update a user's password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - "name"
                - "password"
              properties:
                "name":
                  type: string
                  example: 'Jim'
                "password":
                  type: string
                  example: "Very secret"
      responses:
        200:
          description: "Successfully updated user"
          content:
            application/json:
              schema:
                type: object
                example: {"@type":"api:UsersResponse","api:status":"api:success"}
        400:
          description: Bad Request
          content:
            application/json:
              schema:
                type: object
                example: {"@type":"api:UsersResponse","api:status":"api:success"}
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
    post:
      operationId: createUser
      x-python-client: Client::add_user
      x-js-client: AccessControl.createUser
      tags:
        - Account management
      summary: Create a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - "name"
              properties:
                "name":
                  type: string
                  example: 'Jim'
                "password":
                  type: string
                  example: "Very secret"
      responses:
        200:
          description: "Successfully added user"
          content:
            application/json:
              schema:
                type: object
                example: {"@type":"api:UsersResponse","api:status":"api:success"}
        400:
          description: Bad Request
          content:
            application/json:
              schema:
                type: object
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
  /users/{userName}:
    parameters:
      - name: userName
        in: path
        required: true
        schema:
          type: string
          example: Bob
    get:
      operationId: getUser
      x-python-client: Client::get_user
      x-js-client: not_implemented
      tags:
        - Account Management
      summary: Get a user by name
      parameters:
        - name: capability
          in: query
          description: Get capabilities for the given user
          schema:
            type: boolean
            default: false
      responses:
        200:
          description: Success at acquiring user record
          content:
            application/json:
              schema:
                type: object
                example: {"@id":"User/admin","@type":"User","capability":["Capability/server_access"],"name":"admin"}
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
    delete:
      operationId: deleteUser
      x-python-client: Client::delete_user
      x-js-client: AccessControl.deleteUser
      tags:
        - Account Management
      summary: Delete a user
      responses:
        204:
          description: Success at deleting a user
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
  /migration/{path}:
    parameters:
      - name: path
        in: path
        required: true
        schema:
          type: string
          example: admin/MyDB
    post:
      operationId: migrateSchema
      tags:
        - Change management
      summary: Schema migration either by explicit operation, or implicit schema targetting
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                "author":
                  type: string
                  example: "Jimbo"
                "message":
                  type: string
                  example: "updating schema"
                "operations":
                  type: array
                  items:
                    type: object
                  example: [{"@type" : "DeleteClassProperty", "class" : "MyClass", "property" : "my_property"}]
                "dry_run":
                  type: boolean
                  example: true
                "verbose":
                  type: boolean
                  example: true
                "target":
                  type: string
                  example: "admin/foo"
      responses:
        200:
          description: "Successfully migrated schema"
          content:
            application/json:
              schema:
                type: object
                example: {"@type":"api:MigrationResponse","api:status":"api:success"}
        400:
          description: Bad Request
          content:
            application/json:
              schema:
                type: object
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'
  /capabilities:
    post:
      operationId: manageCapabilities
      x-python-client: Client::change_capabilities
      x-js-client: AccessControl.manageCapability
      tags:
        - Account management
      summary: Grant or remove capabilities over a resource to a user
      description: |
        Grant or revoke roles for a user on a resource (organization or database).
        
        **Quick Start (recommended):**
        ```json
        {
          "operation": "grant",
          "scope_type": "organization",
          "scope": "myorg",
          "user": "alice",
          "roles": ["Admin Role"]
        }
        ```
        
        When `scope_type` is provided, use human-readable names. When omitted, use full system document IDs instead. Use of the `scope_type` field requires system administrative privileges (admin user).
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - "operation"
                - "scope"
                - "user"
                - "roles"
              properties:
                "operation":
                  type: string
                  description: Whether to grant or revoke the specified roles.
                  enum:
                    - "grant"
                    - "revoke"
                "scope_type":
                  type: string
                  description: |
                    Optional. Set this to enable name-based lookups for scope, user, and roles.
                    - "organization": scope is an organization name
                    - "database": scope is "org/database" format
                  enum:
                    - "organization"
                    - "database"
                "scope":
                  type: string
                  description: |
                    The target resource. Format depends on scope_type:
                    - With scope_type "organization": org name, e.g. "admin" or "myorg"
                    - With scope_type "database": "org/db" format, e.g. "admin/mydatabase"
                    - Without scope_type: full ID, e.g. "Organization/abc123...", or "UserDatabase/abc123..."
                  example: "admin"
                "user":
                  type: string
                  description: |
                    The target user.
                    - With scope_type: user name, e.g. "alice"
                    - Without scope_type: full ID, e.g. "User/alice"
                  example: "admin"
                "roles":
                  type: array
                  description: |
                    Roles to grant or revoke.
                    - With scope_type: role names, e.g. ["Admin Role", "Consumer Role"]
                    - Without scope_type: full IDs, e.g. ["Role/abc123..."]
                  items:
                    type: string
                  example: ["Consumer Role", "Admin Role"]
      responses:
        200:
          description: "Successfully granted or revoked roles"
          content:
            application/json:
              schema:
                type: object
                example: {"@type":"api:CapabilityResponse","api:status":"api:success"}
        400:
          description: Bad Request
          content:
            application/json:
              schema:
                type: object
        401:
          $ref: '#/components/responses/IncorrectAuthenticationError'
        403:
          $ref: '#/components/responses/ForbiddenError'

components:

  parameters:
    graph_type:
      name: graph_type
      in: query
      description: Type of the graph
      required: false
      schema:
        type: string
        default: instance
        enum:
          - instance
          - schema
    author:
      name: author
      in: query
      description: Author of commit
      required: true
      schema:
        type: string
        example: Jan
    message:
      name: message
      in: query
      description: Commit message
      required: true
      schema:
        type: string
        example: Fixed bad name for document
    branch_path:
      name: path
      in: path
      description: Path for branch
      required: true
      schema:
        type: string
        example: admin/test/local/branch/foo
    graph_path:
      name: path
      in: path
      description: Path for a specific graph (schema or instance) within a branch
      required: true
      schema:
        type: string
      examples:
        instance_graph:
          value: admin/test/local/branch/main/instance
          summary: Instance data graph of branch 'main'
        schema_graph:
          value: admin/test/local/branch/main/schema
          summary: Schema graph of branch 'main'
        commit_instance:
          value: admin/test/local/commit/q0r08e1hjy123tkf0urzjiov7rrnmp7/instance
          summary: Instance data graph at specific commit
        meta_graph:
          value: admin/test/_meta
          summary: Repository metadata graph
        system_graph:
          value: _system
          summary: System graph
    commit_path:
      name: path
      in: path
      description: Path for a commit or branch
      required: true
      schema:
        type: string
      examples:
        branch:
          value: admin/test/local/branch/foo
        commit:
          value: admin/test/local/commit/q0r08e1hjy123tkf0urzjiov7rrnmp7
    resource_path:
      name: path
      in: path
      description: Path for a resource (a branch, a commit, one of the metadata graphs, or the _system graph)
      required: true
      schema:
        type: string
      examples:
        default_branch:
          value: admin/foo
          summary: branch 'main' of admin/foo (autocompleted to admin/foo/local/branch/main)
        branch:
          value: admin/foo/local/branch/bar
          summary: branch 'bar' of data product 'admin/foo'
        remote_branch:
          value: admin/foo/upstream/branch/bar
          summary: branch 'bar' of the data product 'admin/foo' as it is in the 'upstream' remote
        commit:
          value: admin/foo/local/commit/66smtj9j45bho1vpztzwpi4fbbj8bwa
          summary: a specific commit in data product 'admin/foo'
        local_commits:
          value: admin/foo/local/_commits
          summary: the local commit graph for data product 'admin/foo'
        remote_commits:
          value: admin/foo/upstream/_commits
          summary: the commit graph that of the 'upstream' remote for data product 'admin/foo'
        meta:
          value: admin/foo/_meta
          summary: the metadata graph of data product 'admin/foo'
        system:
          value: _system
          summary: the system graph
    organization:
      name: organization
      in: path
      description: Organization for the database
      required: true
      schema:
        type: string
        example: admin
    database:
      name: database
      in: path
      description: Database name
      required: true
      schema:
        type: string
        example: MyNewDatabase
  schemas:
    WoqlQuery:
      type: object
      properties:
        "query":
          type: object
          # TODO: Add comprehensive WOQL query example
          description: WOQL Query
        "commit_info":
          $ref: "#/components/schemas/CommitInfo"
        "optimize":
          type: boolean
          description: Allow reordering of queries
          default: true
        "all_witnesses":
          type: boolean
          description: Check for all errors
          default: false
    CommitInfo:
      type: object
      properties:
        "author":
          type: string
          example: ExampleUser
        "message":
          type: string
          example: Created something in the data product
    Database:
      type: object
      properties:
        '@id':
          type: string
          example: UserDatabase/MyUserDatabase3315d1a3bb196e322e40bc53ac
        '@type':
          type: string
          example: UserDatabase
        comment:
          type: string
          example: A comment for my database
        creation_date:
          type: string
          example: '2021-12-13T14:27:46.202Z'
        label:
          type: string
          example: MyDatabaseLabel
        name:
          type: string
          example: My Database Name
        state:
          type: string
          example: finalized
    TriplesUpdateResponse:
      type: object
      properties:
        '@type':
          type: string
          example: api:TriplesUpdateResponse
        'api:status':
          type: string
          example: api:success
      required:
        - '@type'
        - 'api:status'
    TriplesInsertResponse:
      type: object
      properties:
        '@type':
          type: string
          example: api:TriplesInsertResponse
        'api:status':
          type: string
          example: api:success
      required:
        - '@type'
        - 'api:status'
  responses:
    IncorrectAuthenticationError:
      description: Authentication information is missing or invalid
      content:
        application/json:
          schema:
            type: object
            properties:
              '@type':
                type: string
                example: api:ErrorResponse
              api:error:
                type: object
                properties:
                  '@type':
                    type: string
                    example: api:IncorrectAuthenticationError
              api:message:
                type: string
                example: Incorrect authentication information
              api:status:
                type: string
                example: api:failure
    ForbiddenError:
      description: User is authenticated but lacks permission for the requested action
      content:
        application/json:
          schema:
            type: object
            properties:
              api:status:
                type: string
                example: api:forbidden
              api:message:
                type: string
                example: Access to resource is not authorised with action read and auth User/anonymous
              auth:
                type: string
                example: User/anonymous
              action:
                type: string
                example: read
              scope:
                type: string
                example: Database/admin/test
  securitySchemes:
    basicAuth:
      type: http
      scheme: basic
